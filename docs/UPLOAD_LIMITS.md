# 上传限制说明

## 文件大小限制

### 直连上传模式（推荐）

- **最大文件大小**: 1GB
- **适用场景**: 大多数文件上传需求
- **优势**: 绕过 Vercel 限制，支持大文件
- **配置**: 需要在应用内配置 CrustFiles.io Access Token
- **网关优化**: 国内优先使用 `https://gw.w3ipfs.org.cn`

### 代理上传模式

- **最大文件大小**: 4.5MB
- **限制来源**: Vercel 免费层请求体大小限制
- **适用场景**: 小文件快速上传
- **优势**: 无需配置 Access Token
- **配置**: 需要在服务端配置 CrustFiles.io Access Token

## 限制对比

| 上传模式 | 最大文件大小 | 配置方式 | 网络优化 | 适用场景 |
|---------|------------|---------|---------|--------|
| 直连上传 | 1GB | 客户端配置 Access Token | 多网关智能调度 | 大文件上传 |
| 代理上传 | 4.5MB | 服务端配置 Access Token | 单一网关 | 小文件上传 |

## 如何选择上传模式

### 推荐使用直连上传模式的场景

1. **大文件上传**: 文件大小超过 4.5MB
2. **频繁上传**: 需要经常上传文件
3. **国内用户**: 希望获得更快的上传速度
4. **稳定性要求**: 需要网关故障自动切换

### 适合使用代理上传模式的场景

1. **小文件快速上传**: 文件大小小于 4.5MB
2. **临时使用**: 不想配置 Access Token
3. **服务端集成**: 需要在服务端处理上传逻辑

## 提升上传限制的方法

### 1. 使用直连上传模式

- 配置 CrustFiles.io Access Token
- 支持最大 1GB 文件上传
- 享受多网关智能调度

### 2. 优化网络连接

- 使用稳定的网络连接
- 国内用户优先使用 `https://gw.w3ipfs.org.cn`
- 避免网络高峰期上传大文件

### 3. 未来计划

- **分片上传**: 支持超过 1GB 的超大文件
- **断点续传**: 网络中断后可以继续上传
- **批量上传**: 支持同时上传多个文件

## 常见问题

### Q1: 为什么我的文件上传失败？

**可能原因**:
- 文件超过大小限制
- 网络连接不稳定
- Access Token 无效
- 网关服务异常

**解决方案**:
- 检查文件大小是否符合限制
- 确保网络连接稳定
- 验证 Access Token 是否有效
- 尝试重新上传（系统会自动切换网关）

### Q2: 如何上传超过 1GB 的文件？

目前暂不支持超过 1GB 的文件上传，我们正在开发分片上传功能，未来将支持更大文件的上传。

### Q3: 上传速度慢怎么办？

**解决方案**:
- 使用直连上传模式
- 确保网络连接稳定
- 国内用户会自动使用 `https://gw.w3ipfs.org.cn`
- 避免网络高峰期上传大文件

## 最佳实践

1. **优先使用直连上传模式**：支持更大文件和更快速度
2. **配置 Access Token**：确保上传功能正常工作
3. **选择合适的文件大小**：根据实际需求选择上传模式
4. **优化网络环境**：确保网络连接稳定
5. **监控上传进度**：及时了解上传状态
6. **使用正确的网关**：国内用户自动使用最优网关

## 技术细节

### 直连上传实现

- **API 端点**: `/api/v0/add`（CrustFiles 原生上传接口）
- **认证方式**: Bearer Token（Access Token）
- **上传机制**: XMLHttpRequest（支持进度显示）
- **网关选择**: 智能多网关调度

### 代理上传实现

- **API 端点**: `/api/crustfiles/upload`（应用代理接口）
- **认证方式**: 服务端配置的 Access Token
- **上传机制**: Next.js API 路由
- **网关选择**: 单一网关

## 性能优化建议

1. **使用 CDN**: 加速静态资源加载
2. **启用缓存**: 提高重复上传速度
3. **优化文件格式**: 压缩文件减小体积
4. **选择合适的上传时间**: 避开网络高峰期
5. **使用多网关**: 提高上传成功率和速度