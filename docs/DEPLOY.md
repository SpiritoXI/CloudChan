# éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å°† CrustShare éƒ¨ç½²åˆ°å„ç§å¹³å°ï¼Œé€‚åˆæ–°æ‰‹é˜…è¯»ã€‚

## ç›®å½•

- [éƒ¨ç½²å‰å‡†å¤‡](#éƒ¨ç½²å‰å‡†å¤‡)
- [æ–¹å¼ä¸€ï¼šCloudflare Pages éƒ¨ç½²ï¼ˆæ¨èï¼‰](#æ–¹å¼ä¸€cloudflare-pages-éƒ¨ç½²æ¨è)
- [æ–¹å¼äºŒï¼šVercel éƒ¨ç½²](#æ–¹å¼äºŒvercel-éƒ¨ç½²)
- [æ–¹å¼ä¸‰ï¼šDocker éƒ¨ç½²](#æ–¹å¼ä¸‰docker-éƒ¨ç½²)
- [æ–¹å¼å››ï¼šè‡ªæ‰˜ç®¡æœåŠ¡å™¨éƒ¨ç½²](#æ–¹å¼å››è‡ªæ‰˜ç®¡æœåŠ¡å™¨éƒ¨ç½²)
- [ç¯å¢ƒå˜é‡é…ç½®è¯¦è§£](#ç¯å¢ƒå˜é‡é…ç½®è¯¦è§£)
- [è‡ªå®šä¹‰åŸŸåé…ç½®](#è‡ªå®šä¹‰åŸŸåé…ç½®)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## éƒ¨ç½²å‰å‡†å¤‡

åœ¨å¼€å§‹éƒ¨ç½²ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²å®Œæˆä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼š

### 1. è·å– Crust Access Tokenï¼ˆå¿…éœ€ï¼‰

è¿™æ˜¯éƒ¨ç½² CrustShare çš„**å¿…éœ€æ¡ä»¶**ï¼Œæ²¡æœ‰å®ƒåº”ç”¨æ— æ³•æ­£å¸¸å·¥ä½œã€‚

**æ­¥éª¤ï¼š**

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [https://crustfiles.io](https://crustfiles.io)

2. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ **"Connect Wallet"** æŒ‰é’®

3. é€‰æ‹©æ‚¨çš„é’±åŒ…ç±»å‹ï¼ˆæ¨è MetaMaskï¼‰ï¼š
   - å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£… MetaMaskï¼Œè¯·å…ˆä» [metamask.io](https://metamask.io) å®‰è£…æµè§ˆå™¨æ‰©å±•
   - åˆ›å»ºæˆ–å¯¼å…¥é’±åŒ…è´¦æˆ·

4. è¿æ¥é’±åŒ…åï¼Œç‚¹å‡» **"Create Developer Profile"** åˆ›å»ºå¼€å‘è€…é…ç½®

5. åœ¨å¼€å‘è€…é…ç½®é¡µé¢ï¼Œæ‚¨ä¼šçœ‹åˆ° **Access Token**ï¼Œç‚¹å‡»å¤åˆ¶æŒ‰é’®

6. **é‡è¦**ï¼šå°† Access Token å®‰å…¨ä¿å­˜ï¼Œä¸è¦æ³„éœ²ç»™ä»»ä½•äººï¼

> âš ï¸ **å®‰å…¨è­¦å‘Š**ï¼šAccess Token åŒ…å«æ‚¨çš„ç§é’¥ä¿¡æ¯ï¼Œæ³„éœ²å¯èƒ½å¯¼è‡´ä»–äººè®¿é—®æ‚¨çš„æ–‡ä»¶ã€‚è¯·å‹¿æäº¤åˆ° GitHub æˆ–å…¶ä»–å…¬å¼€å¹³å°ï¼

### 2. Fork é¡¹ç›®åˆ°æ‚¨çš„ GitHub è´¦æˆ·

1. ç™»å½•æ‚¨çš„ GitHub è´¦æˆ·

2. è®¿é—®é¡¹ç›®åœ°å€ï¼š[https://github.com/SpiritoXI/CrustShare](https://github.com/SpiritoXI/CrustShare)

3. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ **"Fork"** æŒ‰é’®

4. åœ¨å¼¹å‡ºçš„é¡µé¢ä¸­ï¼Œç‚¹å‡» **"Create fork"** ç¡®è®¤

5. Fork å®Œæˆåï¼Œæ‚¨å°†åœ¨è‡ªå·±çš„è´¦æˆ·ä¸‹çœ‹åˆ° `CrustShare` ä»“åº“

### 3. å‡†å¤‡å¯é€‰æœåŠ¡ï¼ˆæ¨èä½†éå¿…éœ€ï¼‰

#### Upstash Redisï¼ˆç”¨äºæ•°æ®æŒä¹…åŒ–ï¼‰

1. è®¿é—® [https://upstash.com](https://upstash.com)
2. æ³¨å†Œå¹¶ç™»å½•
3. åˆ›å»ºä¸€ä¸ªæ–°çš„ Redis æ•°æ®åº“
4. å¤åˆ¶ `UPSTASH_REDIS_REST_URL` å’Œ `UPSTASH_REDIS_REST_TOKEN`

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœä¸é…ç½® Redisï¼Œåº”ç”¨ä¼šä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œé‡å¯åæ•°æ®ä¼šä¸¢å¤±ã€‚

---

## æ–¹å¼ä¸€ï¼šCloudflare Pages éƒ¨ç½²ï¼ˆæ¨èï¼‰

Cloudflare Pages æä¾›å…è´¹çš„é™æ€ç½‘ç«™æ‰˜ç®¡ï¼Œé…åˆ Cloudflare Functions å¯ä»¥è¿è¡ŒæœåŠ¡ç«¯ä»£ç ï¼Œæ˜¯éƒ¨ç½² CrustShare çš„æœ€ä½³é€‰æ‹©ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© Cloudflare Pagesï¼Ÿ

- âœ… å®Œå…¨å…è´¹
- âœ… å…¨çƒ CDN åŠ é€Ÿ
- âœ… è‡ªåŠ¨ HTTPS
- âœ… æ”¯æŒè‡ªå®šä¹‰åŸŸå
- âœ… æ”¯æŒ Serverless Functions

### è¯¦ç»†éƒ¨ç½²æ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šç™»å½• Cloudflare

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [https://dash.cloudflare.com](https://dash.cloudflare.com)

2. å¦‚æœæ²¡æœ‰è´¦æˆ·ï¼Œç‚¹å‡» **"Sign up"** æ³¨å†Œä¸€ä¸ªæ–°è´¦æˆ·

3. ç™»å½•åï¼Œæ‚¨ä¼šçœ‹åˆ° Cloudflare æ§åˆ¶é¢æ¿

#### ç¬¬äºŒæ­¥ï¼šåˆ›å»º Pages é¡¹ç›®

1. åœ¨å·¦ä¾§èœå•ä¸­ï¼Œæ‰¾åˆ°å¹¶ç‚¹å‡» **"Workers & Pages"**

2. ç‚¹å‡»å³ä¸Šè§’çš„ **"Create application"** æŒ‰é’®

3. é€‰æ‹© **"Pages"** æ ‡ç­¾é¡µ

4. ç‚¹å‡» **"Connect to Git"** æŒ‰é’®

#### ç¬¬ä¸‰æ­¥ï¼šè¿æ¥ GitHub ä»“åº“

1. å¦‚æœæ˜¯é¦–æ¬¡ä½¿ç”¨ï¼Œéœ€è¦æˆæƒ Cloudflare è®¿é—®æ‚¨çš„ GitHubï¼š
   - ç‚¹å‡» **"Connect GitHub"**
   - åœ¨å¼¹å‡ºçš„æˆæƒé¡µé¢ï¼Œç‚¹å‡» **"Authorize Cloudflare Pages"**
   - é€‰æ‹© **"Only select repositories"**
   - å‹¾é€‰æ‚¨ Fork çš„ `CrustShare` ä»“åº“
   - ç‚¹å‡» **"Install"** å®Œæˆæˆæƒ

2. è¿”å› Cloudflare é¡µé¢ï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ° `CrustShare` ä»“åº“

3. ç‚¹å‡»è¯¥ä»“åº“æ—è¾¹çš„ **"Begin setup"** æŒ‰é’®

#### ç¬¬å››æ­¥ï¼šé…ç½®æ„å»ºè®¾ç½®

åœ¨é¡¹ç›®è®¾ç½®é¡µé¢ï¼Œå¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

| è®¾ç½®é¡¹ | å¡«å†™å†…å®¹ | è¯´æ˜ |
|--------|----------|------|
| **Project name** | `crustshare` | é¡¹ç›®åç§°ï¼Œä¼šä½œä¸ºé»˜è®¤åŸŸå |
| **Production branch** | `main` | ç”Ÿäº§åˆ†æ”¯ |
| **Framework preset** | `Next.js` | æ¡†æ¶é¢„è®¾ |
| **Build command** | `pnpm build` | æ„å»ºå‘½ä»¤ |
| **Build output directory** | `.next` | è¾“å‡ºç›®å½• |

#### ç¬¬äº”æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆå…³é”®æ­¥éª¤ï¼‰

1. åœ¨åŒä¸€é¡µé¢ï¼Œæ‰¾åˆ° **"Environment variables"** éƒ¨åˆ†

2. ç‚¹å‡» **"Add variable"** æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

   **å˜é‡ 1ï¼ˆå¿…éœ€ï¼‰ï¼š**
   - Variable name: `CRUST_ACCESS_TOKEN`
   - Value: æ‚¨ä¹‹å‰å¤åˆ¶çš„ Access Token
   - é€‰æ‹© **"Encrypt"** åŠ å¯†å­˜å‚¨

   **å˜é‡ 2ï¼ˆå¯é€‰ï¼‰ï¼š**
   - Variable name: `UPSTASH_REDIS_REST_URL`
   - Value: æ‚¨çš„ Upstash Redis URL

   **å˜é‡ 3ï¼ˆå¯é€‰ï¼‰ï¼š**
   - Variable name: `UPSTASH_REDIS_REST_TOKEN`
   - Value: æ‚¨çš„ Upstash Redis Token

#### ç¬¬å…­æ­¥ï¼šå¼€å§‹éƒ¨ç½²

1. ç¡®è®¤æ‰€æœ‰è®¾ç½®æ­£ç¡®åï¼Œç‚¹å‡» **"Save and Deploy"** æŒ‰é’®

2. ç­‰å¾…æ„å»ºå®Œæˆï¼ˆé€šå¸¸éœ€è¦ 2-5 åˆ†é’Ÿï¼‰

3. æ„å»ºè¿‡ç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥ç‚¹å‡» **"View build log"** æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

4. çœ‹åˆ° **"Success! Your site is live"** è¡¨ç¤ºéƒ¨ç½²æˆåŠŸ

#### ç¬¬ä¸ƒæ­¥ï¼šè®¿é—®æ‚¨çš„åº”ç”¨

1. éƒ¨ç½²æˆåŠŸåï¼Œç‚¹å‡» **"Continue to project"**

2. åœ¨é¡¹ç›®æ¦‚è§ˆé¡µé¢ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªç±»ä¼¼ `crustshare.pages.dev` çš„åŸŸå

3. ç‚¹å‡»è¯¥åŸŸåå³å¯è®¿é—®æ‚¨çš„ CrustShare åº”ç”¨

### åç»­æ›´æ–°éƒ¨ç½²

å½“æ‚¨ä¿®æ”¹ä»£ç å¹¶æ¨é€åˆ° GitHub åï¼ŒCloudflare Pages ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ï¼š

```bash
# åœ¨æœ¬åœ°ä¿®æ”¹ä»£ç å
git add .
git commit -m "æ›´æ–°åŠŸèƒ½"
git push origin main

# Cloudflare Pages ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é‡æ–°éƒ¨ç½²
```

---

## æ–¹å¼äºŒï¼šVercel éƒ¨ç½²

Vercel æ˜¯ Next.js çš„å®˜æ–¹æ‰˜ç®¡å¹³å°ï¼Œéƒ¨ç½²ä½“éªŒæä½³ã€‚

### ä¸€é”®éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼‰

1. ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼š

   [![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/SpiritoXI/CrustShare)

2. ç™»å½•æ‚¨çš„ Vercel è´¦æˆ·ï¼ˆå¯ä½¿ç”¨ GitHub ç™»å½•ï¼‰

3. åœ¨ **"Create a Git Repository"** é¡µé¢ï¼š
   - é€‰æ‹© **"Create a private repository"**ï¼ˆæ¨èç§æœ‰ä»“åº“ï¼‰
   - ç‚¹å‡» **"Create"**

4. ç­‰å¾…é¡¹ç›®åˆ›å»ºå’Œåˆå§‹åŒ–

5. åœ¨ **"Configure Project"** é¡µé¢ï¼š
   - å±•å¼€ **"Environment Variables"**
   - æ·»åŠ  `CRUST_ACCESS_TOKEN` å˜é‡
   - ç‚¹å‡» **"Deploy"**

6. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰

7. ç‚¹å‡» **"Go to Dashboard"** æŸ¥çœ‹æ‚¨çš„åº”ç”¨

### é€šè¿‡ CLI éƒ¨ç½²

å¦‚æœæ‚¨æ›´å–œæ¬¢å‘½ä»¤è¡Œæ“ä½œï¼š

```bash
# ç¬¬ä¸€æ­¥ï¼šå®‰è£… Vercel CLI
npm install -g vercel

# ç¬¬äºŒæ­¥ï¼šç™»å½• Vercel
vercel login
# é€‰æ‹©æ‚¨çš„ç™»å½•æ–¹å¼ï¼ˆGitHub æ¨èï¼‰

# ç¬¬ä¸‰æ­¥ï¼šå…‹éš†é¡¹ç›®
git clone https://github.com/YOUR_USERNAME/CrustShare.git
cd CrustShare

# ç¬¬å››æ­¥ï¼šå®‰è£…ä¾èµ–
pnpm install

# ç¬¬äº”æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡
# åˆ›å»º .env.local æ–‡ä»¶å¹¶æ·»åŠ  CRUST_ACCESS_TOKEN

# ç¬¬å…­æ­¥ï¼šéƒ¨ç½²åˆ°é¢„è§ˆç¯å¢ƒ
vercel
# æŒ‰ç…§æç¤ºæ“ä½œï¼Œé¦–æ¬¡ä¼šè¯¢é—®é¡¹ç›®åç§°ç­‰

# ç¬¬ä¸ƒæ­¥ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
vercel --prod
```

### é…ç½®ç¯å¢ƒå˜é‡

éƒ¨ç½²åï¼Œæ‚¨éœ€è¦åœ¨ Vercel æ§åˆ¶å°é…ç½®ç¯å¢ƒå˜é‡ï¼š

1. è¿›å…¥é¡¹ç›® Dashboard

2. ç‚¹å‡» **"Settings"** æ ‡ç­¾

3. åœ¨å·¦ä¾§èœå•ç‚¹å‡» **"Environment Variables"**

4. æ·»åŠ å˜é‡ï¼š
   - Name: `CRUST_ACCESS_TOKEN`
   - Value: æ‚¨çš„ Access Token
   - Environment: é€‰æ‹© Production, Preview, Development

5. ç‚¹å‡» **"Save"**

6. é‡æ–°éƒ¨ç½²é¡¹ç›®ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š
   - ç‚¹å‡» **"Deployments"** æ ‡ç­¾
   - æ‰¾åˆ°æœ€æ–°çš„éƒ¨ç½²
   - ç‚¹å‡»å³ä¾§çš„ **"..."** èœå•
   - é€‰æ‹© **"Redeploy"**

---

## æ–¹å¼ä¸‰ï¼šDocker éƒ¨ç½²

é€‚åˆæœ‰è‡ªå·±çš„æœåŠ¡å™¨æˆ–ç†Ÿæ‚‰ Docker çš„ç”¨æˆ·ã€‚

### å‰ç½®è¦æ±‚

- å·²å®‰è£… Dockerï¼ˆ[å®‰è£…æ•™ç¨‹](https://docs.docker.com/get-docker/)ï¼‰
- å·²å®‰è£… Docker Composeï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰

### å¿«é€Ÿå¼€å§‹

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åˆ›å»ºç›®å½•
mkdir crustshare && cd crustshare

# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env << 'EOF'
CRUST_ACCESS_TOKEN=your_access_token_here
UPSTASH_REDIS_REST_URL=https://your-redis.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_redis_token
EOF
```

#### ç¬¬äºŒæ­¥ï¼šåˆ›å»º Docker Compose é…ç½®

åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼š

```yaml
version: '3.8'

services:
  crustshare:
    image: node:18-alpine
    working_dir: /app
    ports:
      - "3000:3000"
    environment:
      - CRUST_ACCESS_TOKEN=${CRUST_ACCESS_TOKEN}
      - UPSTASH_REDIS_REST_URL=${UPSTASH_REDIS_REST_URL}
      - UPSTASH_REDIS_REST_TOKEN=${UPSTASH_REDIS_REST_TOKEN}
      - NODE_ENV=production
    command: sh -c "
      npm install -g pnpm &&
      pnpm install --prod &&
      pnpm build &&
      pnpm start
    "
    volumes:
      - ./:/app
    restart: unless-stopped
```

#### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### ä½¿ç”¨é¢„æ„å»ºé•œåƒ

å¦‚æœæ‚¨æƒ³ä½¿ç”¨é¢„æ„å»ºçš„ Docker é•œåƒï¼š

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Dockerfile

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `Dockerfile`ï¼š

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS builder

WORKDIR /app

# å®‰è£… pnpm
RUN npm install -g pnpm

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package.json pnpm-lock.yaml ./

# å®‰è£…ä¾èµ–
RUN pnpm install --frozen-lockfile

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºé¡¹ç›®
RUN pnpm build

# è¿è¡Œé˜¶æ®µ
FROM node:18-alpine AS runner

WORKDIR /app

# è®¾ç½®ç”Ÿäº§ç¯å¢ƒ
ENV NODE_ENV=production

# å®‰è£… pnpm
RUN npm install -g pnpm

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public
COPY --from=builder /app/package.json ./
COPY --from=builder /app/pnpm-lock.yaml ./

# å®‰è£…ç”Ÿäº§ä¾èµ–
RUN pnpm install --prod

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨åº”ç”¨
CMD ["pnpm", "start"]
```

#### ç¬¬äºŒæ­¥ï¼šæ„å»ºå’Œè¿è¡Œ

```bash
# æ„å»ºé•œåƒ
docker build -t crustshare:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name crustshare \
  -p 3000:3000 \
  -e CRUST_ACCESS_TOKEN=your_token_here \
  --restart unless-stopped \
  crustshare:latest

# æŸ¥çœ‹æ—¥å¿—
docker logs -f crustshare

# åœæ­¢å®¹å™¨
docker stop crustshare

# åˆ é™¤å®¹å™¨
docker rm crustshare
```

---

## æ–¹å¼å››ï¼šè‡ªæ‰˜ç®¡æœåŠ¡å™¨éƒ¨ç½²

é€‚åˆæœ‰è‡ªå·±æœåŠ¡å™¨ï¼ˆVPSï¼‰çš„ç”¨æˆ·ã€‚

### æœåŠ¡å™¨è¦æ±‚

| é…ç½®é¡¹ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|--------|----------|----------|
| CPU | 1 æ ¸ | 2 æ ¸+ |
| å†…å­˜ | 1 GB | 2 GB+ |
| å­˜å‚¨ | 10 GB | 20 GB+ |
| ç³»ç»Ÿ | Ubuntu 20.04+ | Ubuntu 22.04 |

### è¯¦ç»†éƒ¨ç½²æ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šè¿æ¥æœåŠ¡å™¨

```bash
# ä½¿ç”¨ SSH è¿æ¥æœåŠ¡å™¨
ssh root@your_server_ip

# æˆ–ä½¿ç”¨ç”¨æˆ·å
ssh username@your_server_ip
```

#### ç¬¬äºŒæ­¥ï¼šå®‰è£… Node.js

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£… Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node --version   # åº”æ˜¾ç¤º v18.x.x
npm --version    # åº”æ˜¾ç¤º 9.x.x æˆ–æ›´é«˜

# å®‰è£… pnpm
npm install -g pnpm

# éªŒè¯ pnpm
pnpm --version
```

#### ç¬¬ä¸‰æ­¥ï¼šå®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰

```bash
# å…¨å±€å®‰è£… PM2
sudo npm install -g pm2

# éªŒè¯å®‰è£…
pm2 --version
```

#### ç¬¬å››æ­¥ï¼šå…‹éš†é¡¹ç›®

```bash
# åˆ›å»ºåº”ç”¨ç›®å½•
sudo mkdir -p /var/www
cd /var/www

# å…‹éš†é¡¹ç›®
sudo git clone https://github.com/YOUR_USERNAME/CrustShare.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd CrustShare

# è®¾ç½®ç›®å½•æƒé™
sudo chown -R $USER:$USER /var/www/CrustShare
```

#### ç¬¬äº”æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
nano .env.local
```

åœ¨ç¼–è¾‘å™¨ä¸­è¾“å…¥ï¼š

```env
CRUST_ACCESS_TOKEN=your_access_token_here
UPSTASH_REDIS_REST_URL=https://your-redis.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_redis_token
```

æŒ‰ `Ctrl + O` ä¿å­˜ï¼ŒæŒ‰ `Ctrl + X` é€€å‡ºã€‚

#### ç¬¬å…­æ­¥ï¼šå®‰è£…ä¾èµ–å¹¶æ„å»º

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºé¡¹ç›®
pnpm build
```

#### ç¬¬ä¸ƒæ­¥ï¼šä½¿ç”¨ PM2 å¯åŠ¨

```bash
# å¯åŠ¨åº”ç”¨
pm2 start pnpm --name "crustshare" -- start

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs crustshare

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
# æŒ‰ç…§æç¤ºæ‰§è¡Œè¾“å‡ºçš„å‘½ä»¤

# ä¿å­˜ PM2 é…ç½®
pm2 save
```

#### ç¬¬å…«æ­¥ï¼šé…ç½® Nginx åå‘ä»£ç†

```bash
# å®‰è£… Nginx
sudo apt install -y nginx

# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/crustshare
```

è¾“å…¥ä»¥ä¸‹é…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;  # æ›¿æ¢ä¸ºæ‚¨çš„åŸŸåæˆ–æœåŠ¡å™¨ IP

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆ1GBï¼‰
        client_max_body_size 1024M;
    }
}
```

```bash
# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/crustshare /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½ Nginx
sudo systemctl reload nginx
```

#### ç¬¬ä¹æ­¥ï¼šé…ç½® HTTPSï¼ˆæ¨èï¼‰

```bash
# å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å– SSL è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# æŒ‰ç…§æç¤ºè¾“å…¥é‚®ç®±å¹¶åŒæ„æ¡æ¬¾

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs crustshare

# é‡å¯åº”ç”¨
pm2 restart crustshare

# åœæ­¢åº”ç”¨
pm2 stop crustshare

# æ›´æ–°ä»£ç åé‡æ–°éƒ¨ç½²
cd /var/www/CrustShare
git pull
pnpm install
pnpm build
pm2 restart crustshare
```

---

## ç¯å¢ƒå˜é‡é…ç½®è¯¦è§£

### å¿…éœ€å˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `CRUST_ACCESS_TOKEN` | Crust è®¿é—®ä»¤ç‰Œï¼Œç”¨äºä¸Šä¼ æ–‡ä»¶åˆ° IPFS | `eyJhbGciOiJIUzI1NiIsInR5cCI6...` |

### å¯é€‰å˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹å€¼ |
|--------|------|--------|--------|
| `UPSTASH_REDIS_REST_URL` | Upstash Redis REST API åœ°å€ | - | `https://us1-xxxxx.upstash.io` |
| `UPSTASH_REDIS_REST_TOKEN` | Upstash Redis è®¿é—®ä»¤ç‰Œ | - | `AXXXXX...` |
| `NEXT_PUBLIC_APP_URL` | åº”ç”¨å…¬å¼€è®¿é—®åœ°å€ | è‡ªåŠ¨æ£€æµ‹ | `https://crustshare.example.com` |
| `NEXT_PUBLIC_APP_NAME` | åº”ç”¨åç§° | `CrustShare` | `æˆ‘çš„æ–‡ä»¶åˆ†äº«ç«™` |

### å˜é‡ä½œç”¨è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç¯å¢ƒå˜é‡ä½œç”¨å›¾                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  CRUST_ACCESS_TOKEN (å¿…éœ€)                                  â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â”€ ä¸Šä¼ æ–‡ä»¶åˆ° IPFS                                        â”‚
â”‚  â”œâ”€â”€ åˆ›å»ºå­˜å‚¨è®¢å•                                           â”‚
â”‚  â””â”€â”€ è®¿é—® Crust ç½‘ç»œèµ„æº                                    â”‚
â”‚                                                             â”‚
â”‚  UPSTASH_REDIS_REST_URL / TOKEN (å¯é€‰)                      â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â”€ å­˜å‚¨æ–‡ä»¶å…ƒæ•°æ®                                         â”‚
â”‚  â”œâ”€â”€ å­˜å‚¨æ–‡ä»¶å¤¹ç»“æ„                                         â”‚
â”‚  â”œâ”€â”€ å­˜å‚¨åˆ†äº«é“¾æ¥ä¿¡æ¯                                       â”‚
â”‚  â””â”€â”€ ç¼“å­˜ç½‘å…³å¥åº·çŠ¶æ€                                       â”‚
â”‚                                                             â”‚
â”‚  å¦‚æœä¸é…ç½® Redisï¼š                                          â”‚
â”‚  â””â”€â”€ ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼ˆé‡å¯åæ•°æ®ä¸¢å¤±ï¼‰                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è‡ªå®šä¹‰åŸŸåé…ç½®

### Cloudflare Pages é…ç½®è‡ªå®šä¹‰åŸŸå

1. è¿›å…¥æ‚¨çš„ Cloudflare Pages é¡¹ç›®

2. ç‚¹å‡» **"Settings"** > **"Custom domains"**

3. ç‚¹å‡» **"Set up a custom domain"**

4. è¾“å…¥æ‚¨çš„åŸŸåï¼ˆå¦‚ `share.yourdomain.com`ï¼‰

5. ç‚¹å‡» **"Activate domain"**

6. æŒ‰ç…§æç¤ºåœ¨æ‚¨çš„åŸŸå DNS è®¾ç½®ä¸­æ·»åŠ  CNAME è®°å½•ï¼š
   - åç§°: `share`
   - ç›®æ ‡: `crustshare.pages.dev`

7. ç­‰å¾… DNS ç”Ÿæ•ˆï¼ˆé€šå¸¸å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰

### Vercel é…ç½®è‡ªå®šä¹‰åŸŸå

1. è¿›å…¥æ‚¨çš„ Vercel é¡¹ç›®

2. ç‚¹å‡» **"Settings"** > **"Domains"**

3. è¾“å…¥æ‚¨çš„åŸŸåå¹¶ç‚¹å‡» **"Add"**

4. æŒ‰ç…§æç¤ºé…ç½® DNS è®°å½•ï¼š
   - å¦‚æœä½¿ç”¨å­åŸŸåï¼ˆå¦‚ `share.yourdomain.com`ï¼‰ï¼šæ·»åŠ  CNAME è®°å½•
   - å¦‚æœä½¿ç”¨æ ¹åŸŸåï¼šæ·»åŠ  A è®°å½•

5. ç­‰å¾… SSL è¯ä¹¦è‡ªåŠ¨é…ç½®å®Œæˆ

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šéƒ¨ç½²åé¡µé¢æ˜¾ç¤º 500 é”™è¯¯

**å¯èƒ½åŸå› **ï¼šç¯å¢ƒå˜é‡æœªé…ç½®æˆ–é…ç½®é”™è¯¯

**è§£å†³æ­¥éª¤**ï¼š

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
# Cloudflare Pages: Settings > Environment variables
# Vercel: Settings > Environment Variables

# ç¡®è®¤ CRUST_ACCESS_TOKEN å·²æ·»åŠ ä¸”å€¼æ­£ç¡®
```

### é—®é¢˜ 2ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥

**å¯èƒ½åŸå› **ï¼šAccess Token æ— æ•ˆæˆ–è¿‡æœŸ

**è§£å†³æ­¥éª¤**ï¼š

1. è®¿é—® [crustfiles.io](https://crustfiles.io)
2. æ£€æŸ¥ Developer Profile çŠ¶æ€
3. å¦‚æœéœ€è¦ï¼Œé‡æ–°ç”Ÿæˆ Access Token
4. æ›´æ–°éƒ¨ç½²å¹³å°çš„ç¯å¢ƒå˜é‡
5. é‡æ–°éƒ¨ç½²åº”ç”¨

### é—®é¢˜ 3ï¼šæ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶

**è¯´æ˜**ï¼šCrustShare æ”¯æŒæœ€å¤§ 1GB çš„æ–‡ä»¶ä¸Šä¼ 

**è§£å†³æ­¥éª¤**ï¼š

- ç¡®ä¿æ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 1GB
- å¦‚æœä½¿ç”¨ Nginx åå‘ä»£ç†ï¼Œç¡®ä¿ `client_max_body_size` è®¾ç½®æ­£ç¡®
- æ£€æŸ¥ç½‘ç»œç¨³å®šæ€§ï¼Œå¤§æ–‡ä»¶ä¸Šä¼ éœ€è¦è¾ƒé•¿æ—¶é—´

### é—®é¢˜ 4ï¼šæ•°æ®ä¸¢å¤±

**å¯èƒ½åŸå› **ï¼šæœªé…ç½® Redisï¼Œä½¿ç”¨å†…å­˜å­˜å‚¨

**è§£å†³æ­¥éª¤**ï¼š

1. æ³¨å†Œ Upstash è´¦æˆ·å¹¶åˆ›å»º Redis æ•°æ®åº“
2. è·å– `UPSTASH_REDIS_REST_URL` å’Œ `UPSTASH_REDIS_REST_TOKEN`
3. åœ¨éƒ¨ç½²å¹³å°æ·»åŠ è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡
4. é‡æ–°éƒ¨ç½²åº”ç”¨

### é—®é¢˜ 5ï¼šæ„å»ºå¤±è´¥

**å¯èƒ½åŸå› **ï¼šä¾èµ–å®‰è£…å¤±è´¥æˆ– Node.js ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³æ­¥éª¤**ï¼š

```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬ï¼ˆéœ€è¦ 18+ï¼‰
node --version

# æ¸…é™¤ç¼“å­˜é‡æ–°å®‰è£…
rm -rf node_modules pnpm-lock.yaml
pnpm install

# é‡æ–°æ„å»º
pnpm build
```

### é—®é¢˜ 6ï¼šè‡ªå®šä¹‰åŸŸåæ— æ³•è®¿é—®

**å¯èƒ½åŸå› **ï¼šDNS æœªç”Ÿæ•ˆæˆ–é…ç½®é”™è¯¯

**è§£å†³æ­¥éª¤**ï¼š

```bash
# æ£€æŸ¥ DNS è§£æ
nslookup share.yourdomain.com

# æˆ–ä½¿ç”¨ dig
dig share.yourdomain.com

# ç¡®è®¤ DNS è®°å½•ç±»å‹å’Œå€¼æ­£ç¡®
```

### é—®é¢˜ 7ï¼šç½‘å…³æµ‹è¯•å¤±è´¥

**å¯èƒ½åŸå› **ï¼šç½‘ç»œé—®é¢˜æˆ–ç½‘å…³æš‚æ—¶ä¸å¯ç”¨

**è§£å†³æ­¥éª¤**ï¼š

1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å°è¯•åˆ·æ–°ç½‘å…³åˆ—è¡¨
3. ä½¿ç”¨é»˜è®¤ç½‘å…³åˆ—è¡¨
4. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š
   - Cloudflare Pages: Deployments > ç‚¹å‡»éƒ¨ç½² > View build log
   - Vercel: Deployments > ç‚¹å‡»éƒ¨ç½² > Runtime Logs
   - Docker: `docker logs crustshare`
   - PM2: `pm2 logs crustshare`

2. åœ¨ GitHub æäº¤ Issueï¼š[https://github.com/SpiritoXI/CrustShare/issues](https://github.com/SpiritoXI/CrustShare/issues)

---

## ç›¸å…³é“¾æ¥

- [Cloudflare Pages æ–‡æ¡£](https://developers.cloudflare.com/pages/)
- [Vercel æ–‡æ¡£](https://vercel.com/docs)
- [Next.js éƒ¨ç½²æ–‡æ¡£](https://nextjs.org/docs/deployment)
- [Docker æ–‡æ¡£](https://docs.docker.com/)
- [PM2 æ–‡æ¡£](https://pm2.keymetrics.io/)
- [Crust Network æ–‡æ¡£](https://wiki.crust.network/)
